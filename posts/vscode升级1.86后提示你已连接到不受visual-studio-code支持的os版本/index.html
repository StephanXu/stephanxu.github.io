<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>VSCode升级18.6后提示“你已连接到不受Visual Studio Code支持的OS版本 - Stephan Xu</title><meta name=Description content><meta property="og:title" content="VSCode升级18.6后提示“你已连接到不受Visual Studio Code支持的OS版本"><meta property="og:description" content="发生了什么？ 在VSCode最近的一次更新中，提升远程开发使用的node版本，更新后的node依赖glibc>=2.28。
在升级1.86版本后，如果尝试连接glibc 2.28以下版本的开发机，会提示连接到不受支持的OS版本。
按照官方的要求。最好的解决方案自然是升级到更新的glibc版本，这也意味着需要使用更新的系统版本。在社区的热烈讨论下，VSCode项目组最终对于旧glibc延长额外支持12个月。但新版本连接到旧glibc服务器后，仍然会有一行醒目的提示：
本文提供一种极端手动的方法（本来是给开发环境的dockerfile使用），即手动编译一份glibc和node，以专供VSCode的远端服务器使用。
开搞 1. 从编译器说起 (可选) 从文档来看，node现在已经要求到了GCC 10，我们的环境很有可能没准备。（如果你的环境已经有一份比较高版本的编译器，可以跳过这里啦）
这里准备了一份贴贴心的安装脚本，以防你真的没有更新的GCC。为了避免搞坏你的环境，它只会在/usr/local/bin下建立gcc-12和g++-12，而不会覆盖掉默认的gcc，g++命令。
# 编译一份GCC, 参考时间半个钟, 配置好的机器请自行按照CPU核心数酌情修改make -jN curl -OL &#34;https://ftp.gnu.org/gnu/gcc/gcc-12.2.0/gcc-12.2.0.tar.gz&#34; \ && tar -zxvf gcc-12.2.0.tar.gz \ && pushd gcc-12.2.0 \ && ./configure --prefix=/usr/local/gcc-12.2.0 \ && make -j8 \ && make install \ && ln -s /usr/local/gcc-12.2.0/bin/gcc /usr/bin/gcc-12 \ && ln -s /usr/local/gcc-12.2.0/bin/g++ /usr/bin/g++-12 \ && popd \ && rm -r gcc-12.2.0.tar.gz gcc-12.2.0 编译了以后记得把LD_LIBRARY_PATH加上:
export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/usr/local/gcc-12.2.0/lib64 2. 来一份Glibc 这里我选择编译glibc 2.30，glibc需要更新一些的binutils和make，遂编译之。"><meta property="og:type" content="article"><meta property="og:url" content="http://www.fenzhengrou.wang/posts/vscode%E5%8D%87%E7%BA%A71.86%E5%90%8E%E6%8F%90%E7%A4%BA%E4%BD%A0%E5%B7%B2%E8%BF%9E%E6%8E%A5%E5%88%B0%E4%B8%8D%E5%8F%97visual-studio-code%E6%94%AF%E6%8C%81%E7%9A%84os%E7%89%88%E6%9C%AC/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-19T20:00:00+08:00"><meta property="article:modified_time" content="2024-02-19T20:00:00+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="VSCode升级18.6后提示“你已连接到不受Visual Studio Code支持的OS版本"><meta name=twitter:description content="发生了什么？ 在VSCode最近的一次更新中，提升远程开发使用的node版本，更新后的node依赖glibc>=2.28。
在升级1.86版本后，如果尝试连接glibc 2.28以下版本的开发机，会提示连接到不受支持的OS版本。
按照官方的要求。最好的解决方案自然是升级到更新的glibc版本，这也意味着需要使用更新的系统版本。在社区的热烈讨论下，VSCode项目组最终对于旧glibc延长额外支持12个月。但新版本连接到旧glibc服务器后，仍然会有一行醒目的提示：
本文提供一种极端手动的方法（本来是给开发环境的dockerfile使用），即手动编译一份glibc和node，以专供VSCode的远端服务器使用。
开搞 1. 从编译器说起 (可选) 从文档来看，node现在已经要求到了GCC 10，我们的环境很有可能没准备。（如果你的环境已经有一份比较高版本的编译器，可以跳过这里啦）
这里准备了一份贴贴心的安装脚本，以防你真的没有更新的GCC。为了避免搞坏你的环境，它只会在/usr/local/bin下建立gcc-12和g++-12，而不会覆盖掉默认的gcc，g++命令。
# 编译一份GCC, 参考时间半个钟, 配置好的机器请自行按照CPU核心数酌情修改make -jN curl -OL &#34;https://ftp.gnu.org/gnu/gcc/gcc-12.2.0/gcc-12.2.0.tar.gz&#34; \ && tar -zxvf gcc-12.2.0.tar.gz \ && pushd gcc-12.2.0 \ && ./configure --prefix=/usr/local/gcc-12.2.0 \ && make -j8 \ && make install \ && ln -s /usr/local/gcc-12.2.0/bin/gcc /usr/bin/gcc-12 \ && ln -s /usr/local/gcc-12.2.0/bin/g++ /usr/bin/g++-12 \ && popd \ && rm -r gcc-12.2.0.tar.gz gcc-12.2.0 编译了以后记得把LD_LIBRARY_PATH加上:
export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/usr/local/gcc-12.2.0/lib64 2. 来一份Glibc 这里我选择编译glibc 2.30，glibc需要更新一些的binutils和make，遂编译之。"><meta name=application-name content="Stephan Xu"><meta name=apple-mobile-web-app-title content="Stephan Xu"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://www.fenzhengrou.wang/posts/vscode%E5%8D%87%E7%BA%A71.86%E5%90%8E%E6%8F%90%E7%A4%BA%E4%BD%A0%E5%B7%B2%E8%BF%9E%E6%8E%A5%E5%88%B0%E4%B8%8D%E5%8F%97visual-studio-code%E6%94%AF%E6%8C%81%E7%9A%84os%E7%89%88%E6%9C%AC/><link rel=prev href=http://www.fenzhengrou.wang/posts/%E7%BA%A2%E9%BB%91%E6%A0%91%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"VSCode升级18.6后提示“你已连接到不受Visual Studio Code支持的OS版本","inLanguage":"zh-cn","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/www.fenzhengrou.wang\/posts\/vscode%E5%8D%87%E7%BA%A71.86%E5%90%8E%E6%8F%90%E7%A4%BA%E4%BD%A0%E5%B7%B2%E8%BF%9E%E6%8E%A5%E5%88%B0%E4%B8%8D%E5%8F%97visual-studio-code%E6%94%AF%E6%8C%81%E7%9A%84os%E7%89%88%E6%9C%AC\/"},"genre":"posts","wordcount":408,"url":"http:\/\/www.fenzhengrou.wang\/posts\/vscode%E5%8D%87%E7%BA%A71.86%E5%90%8E%E6%8F%90%E7%A4%BA%E4%BD%A0%E5%B7%B2%E8%BF%9E%E6%8E%A5%E5%88%B0%E4%B8%8D%E5%8F%97visual-studio-code%E6%94%AF%E6%8C%81%E7%9A%84os%E7%89%88%E6%9C%AC\/","datePublished":"2024-02-19T20:00:00+08:00","dateModified":"2024-02-19T20:00:00+08:00","publisher":{"@type":"Organization","name":"徐梓涵"},"author":{"@type":"Person","name":"徐梓涵"},"description":""}</script></head><body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Stephan Xu">Stephan Xu</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>归类 </a><a class=menu-item href=/>主页 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Stephan Xu">Stephan Xu</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile></a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>归类</a><a class=menu-item href=/ title>主页</a><a href=javascript:void(0); class="menu-item theme-switch" title>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title></h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">VSCode升级18.6后提示“你已连接到不受Visual Studio Code支持的OS版本</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>徐梓涵</a></span>&nbsp;<span class=post-category></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2024-02-19>2024-02-19</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span></span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#发生了什么><strong>发生了什么？</strong></a></li><li><a href=#开搞><strong>开搞</strong></a><ul><li><a href=#1-从编译器说起-可选><strong>1. 从编译器说起 (可选)</strong></a></li><li><a href=#2-来一份glibc><strong>2. 来一份Glibc</strong></a></li><li><a href=#3-来一份node><strong>3. 来一份node</strong></a></li><li><a href=#4-patch一下><strong>4. patch一下</strong></a></li><li><a href=#5-替换到vscode><strong>5. 替换到VSCode</strong></a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=发生了什么><strong>发生了什么？</strong></h2><p>在VSCode最近的一次更新中，提升远程开发使用的<code>node</code>版本，更新后的<code>node</code>依赖<code>glibc>=2.28</code>。</p><p>在升级1.86版本后，如果尝试连接glibc 2.28以下版本的开发机，会提示连接到不受支持的OS版本。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=assets/%e8%bf%9e%e6%8e%a5%e5%a4%b1%e8%b4%a5%e6%8f%90%e7%a4%ba.png data-srcset="/posts/vscode%E5%8D%87%E7%BA%A71.86%E5%90%8E%E6%8F%90%E7%A4%BA%E4%BD%A0%E5%B7%B2%E8%BF%9E%E6%8E%A5%E5%88%B0%E4%B8%8D%E5%8F%97visual-studio-code%E6%94%AF%E6%8C%81%E7%9A%84os%E7%89%88%E6%9C%AC/assets/%E8%BF%9E%E6%8E%A5%E5%A4%B1%E8%B4%A5%E6%8F%90%E7%A4%BA.png, assets/%e8%bf%9e%e6%8e%a5%e5%a4%b1%e8%b4%a5%e6%8f%90%e7%a4%ba.png 1.5x, /posts/vscode%E5%8D%87%E7%BA%A71.86%E5%90%8E%E6%8F%90%E7%A4%BA%E4%BD%A0%E5%B7%B2%E8%BF%9E%E6%8E%A5%E5%88%B0%E4%B8%8D%E5%8F%97visual-studio-code%E6%94%AF%E6%8C%81%E7%9A%84os%E7%89%88%E6%9C%AC/assets/%E8%BF%9E%E6%8E%A5%E5%A4%B1%E8%B4%A5%E6%8F%90%E7%A4%BA.png 2x" data-sizes=auto alt=/posts/vscode%E5%8D%87%E7%BA%A71.86%E5%90%8E%E6%8F%90%E7%A4%BA%E4%BD%A0%E5%B7%B2%E8%BF%9E%E6%8E%A5%E5%88%B0%E4%B8%8D%E5%8F%97visual-studio-code%E6%94%AF%E6%8C%81%E7%9A%84os%E7%89%88%E6%9C%AC/assets/%E8%BF%9E%E6%8E%A5%E5%A4%B1%E8%B4%A5%E6%8F%90%E7%A4%BA.png title=连接失败提示></p><p>按照官方的<a href=https://code.visualstudio.com/docs/remote/linux#_remote-host-container-wsl-linux-prerequisites target=_blank rel="noopener noreffer">要求</a>。最好的解决方案自然是升级到更新的glibc版本，这也意味着需要使用更新的系统版本。在社区的<a href=https://github.com/microsoft/vscode/issues/203967 target=_blank rel="noopener noreffer">热烈讨论</a>下，VSCode项目组最终对于旧glibc延长额外支持12个月。但新版本连接到旧glibc服务器后，仍然会有一行醒目的提示：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=assets/%e5%a4%b4%e9%83%a8%e8%ad%a6%e5%91%8a.png data-srcset="/posts/vscode%E5%8D%87%E7%BA%A71.86%E5%90%8E%E6%8F%90%E7%A4%BA%E4%BD%A0%E5%B7%B2%E8%BF%9E%E6%8E%A5%E5%88%B0%E4%B8%8D%E5%8F%97visual-studio-code%E6%94%AF%E6%8C%81%E7%9A%84os%E7%89%88%E6%9C%AC/assets/%E5%A4%B4%E9%83%A8%E8%AD%A6%E5%91%8A.png, assets/%e5%a4%b4%e9%83%a8%e8%ad%a6%e5%91%8a.png 1.5x, /posts/vscode%E5%8D%87%E7%BA%A71.86%E5%90%8E%E6%8F%90%E7%A4%BA%E4%BD%A0%E5%B7%B2%E8%BF%9E%E6%8E%A5%E5%88%B0%E4%B8%8D%E5%8F%97visual-studio-code%E6%94%AF%E6%8C%81%E7%9A%84os%E7%89%88%E6%9C%AC/assets/%E5%A4%B4%E9%83%A8%E8%AD%A6%E5%91%8A.png 2x" data-sizes=auto alt=/posts/vscode%E5%8D%87%E7%BA%A71.86%E5%90%8E%E6%8F%90%E7%A4%BA%E4%BD%A0%E5%B7%B2%E8%BF%9E%E6%8E%A5%E5%88%B0%E4%B8%8D%E5%8F%97visual-studio-code%E6%94%AF%E6%8C%81%E7%9A%84os%E7%89%88%E6%9C%AC/assets/%E5%A4%B4%E9%83%A8%E8%AD%A6%E5%91%8A.png title=头部警告></p><p>本文提供一种极端手动的方法（本来是给开发环境的dockerfile使用），即手动编译一份glibc和node，以专供VSCode的远端服务器使用。</p><h2 id=开搞><strong>开搞</strong></h2><h3 id=1-从编译器说起-可选><strong>1. 从编译器说起 (可选)</strong></h3><p>从<a href=https://github.com/nodejs/node/blob/main/BUILDING.md target=_blank rel="noopener noreffer">文档</a>来看，node现在已经要求到了GCC 10，我们的环境很有可能没准备。（如果你的环境已经有一份比较高版本的编译器，可以跳过这里啦）</p><p>这里准备了一份贴贴心的安装脚本，<strong>以防你真的没有更新的GCC</strong>。为了避免搞坏你的环境，它只会在<code>/usr/local/bin</code>下建立<code>gcc-12</code>和<code>g++-12</code>，而不会覆盖掉默认的<code>gcc</code>，<code>g++</code>命令。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 编译一份GCC, 参考时间半个钟, 配置好的机器请自行按照CPU核心数酌情修改make -jN</span>
</span></span><span class=line><span class=cl>curl -OL <span class=s2>&#34;https://ftp.gnu.org/gnu/gcc/gcc-12.2.0/gcc-12.2.0.tar.gz&#34;</span> <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> tar -zxvf gcc-12.2.0.tar.gz <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>pushd</span> gcc-12.2.0 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> ./configure --prefix<span class=o>=</span>/usr/local/gcc-12.2.0 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> make -j8 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> make install <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> ln -s /usr/local/gcc-12.2.0/bin/gcc /usr/bin/gcc-12 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> ln -s /usr/local/gcc-12.2.0/bin/g++ /usr/bin/g++-12 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>popd</span> <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> rm -r gcc-12.2.0.tar.gz gcc-12.2.0
</span></span></code></pre></div><p>编译了以后记得把<code>LD_LIBRARY_PATH</code>加上:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>LD_LIBRARY_PATH</span><span class=o>=</span><span class=si>${</span><span class=nv>LD_LIBRARY_PATH</span><span class=si>}</span>:/usr/local/gcc-12.2.0/lib64
</span></span></code></pre></div><h3 id=2-来一份glibc><strong>2. 来一份Glibc</strong></h3><p>这里我选择编译glibc 2.30，glibc需要更新一些的binutils和make，遂编译之。</p><p>按照上文，此处我使用了一份手动编译的，较新版本的gcc编译器，如果你的版本已经足够支持，可以不需要手动指定<code>CC</code>和<code>CXX</code>环境变量</p><blockquote><p>因为是从Dockerfile里抠出来的，有一些重复的export，也方便各位节选了🙏</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 编译binutils，参考时间小于5分钟</span>
</span></span><span class=line><span class=cl>curl -OL <span class=s2>&#34;https://ftp.gnu.org/gnu/binutils/binutils-2.34.tar.gz&#34;</span> <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> tar -zxvf binutils-2.34.tar.gz <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>pushd</span> binutils-2.34 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>export</span> <span class=nv>CC</span><span class=o>=</span>/usr/bin/gcc-12 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>export</span> <span class=nv>CXX</span><span class=o>=</span>/usr/bin/g++-12 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> ./configure --prefix<span class=o>=</span>/usr/local/binutils-2.34 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> make -j8 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> make install <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>popd</span> <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> rm -r binutils-2.34 binutils-2.34.tar.gz
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 编译make，参考时间小于5分钟。</span>
</span></span><span class=line><span class=cl>curl -OL <span class=s2>&#34;https://ftp.gnu.org/gnu/make/make-4.1.tar.gz&#34;</span> <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> tar -zxvf make-4.1.tar.gz <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>pushd</span> make-4.1 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>export</span> <span class=nv>CC</span><span class=o>=</span>/usr/bin/gcc-12 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>export</span> <span class=nv>CXX</span><span class=o>=</span>/usr/bin/g++-12 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span>/usr/local/binutils-2.34/bin:<span class=nv>$PATH</span> <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> ./configure --prefix<span class=o>=</span>/usr/local/make-4.1 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> make -j8 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> make install <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> ln -sf /usr/local/make-4.1/bin/make /usr/local/make-4.1/bin/gmake <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>popd</span> <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> rm -r make-4.1 make-4.1.tar.gz
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 编译glibc，参考时间小于10分钟</span>
</span></span><span class=line><span class=cl>curl -OL <span class=s2>&#34;https://ftp.gnu.org/gnu/glibc/glibc-2.30.tar.gz&#34;</span> <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> tar -zxvf glibc-2.30.tar.gz <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>pushd</span> glibc-2.30 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> mkdir -p build <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>pushd</span> build <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>export</span> <span class=nv>CC</span><span class=o>=</span>/usr/bin/gcc-12 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>export</span> <span class=nv>CXX</span><span class=o>=</span>/usr/bin/g++-12 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span>/usr/local/binutils-2.34/bin:/usr/local/make-4.1/bin:<span class=nv>$PATH</span> <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>export</span> <span class=nv>LD_LIBRARY_PATH</span><span class=o>=</span>/usr/local/gcc-12.2.0/lib64:/usr/local/gcc-12.2.0/lib64 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>export</span> <span class=nv>CXXFLAGS</span><span class=o>=</span><span class=s2>&#34;-g -O2 -Wno-array-parameter&#34;</span> <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>export</span> <span class=nv>CFLAGS</span><span class=o>=</span><span class=s2>&#34;-g -O2 -Wno-array-parameter&#34;</span> <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> ../configure --prefix<span class=o>=</span>/usr/local/glibc-2.30 --disable-werror <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> make -j8 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> make install <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>popd</span> <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>popd</span> <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> rm -r glibc-2.30 glibc-2.30.tar.gz
</span></span></code></pre></div><h3 id=3-来一份node><strong>3. 来一份node</strong></h3><p>这里选择了v18.19，直接开编吧。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 编译node，参考时间20分钟</span>
</span></span><span class=line><span class=cl>git clone --depth<span class=o>=</span><span class=m>1</span> -b v18.19.0 https://github.com/nodejs/node.git <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>pushd</span> node <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>export</span> <span class=nv>CC</span><span class=o>=</span>/usr/bin/gcc-12 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>export</span> <span class=nv>CXX</span><span class=o>=</span>/usr/bin/g++-12 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span>/usr/local/binutils-2.34/bin:/usr/local/make-4.1/bin:<span class=nv>$PATH</span> <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> ./configure --prefix<span class=o>=</span>/usr/local/node-18.19 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> make -j8 <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> make install <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>popd</span> <span class=se>\ </span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> rm -r node
</span></span></code></pre></div><h3 id=4-patch一下><strong>4. patch一下</strong></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 以防你真的没有patchelf</span>
</span></span><span class=line><span class=cl>yum install patchelf
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 这里不同环境具体文件名可能不同，但路径基本一致，请按实际情况修改</span>
</span></span><span class=line><span class=cl>patchelf --set-interpreter /usr/local/glibc-2.30/lib/ld-linux-x86-64.so.2 <span class=se>\ </span>
</span></span><span class=line><span class=cl>         --set-rpath /usr/local/glibc-2.30/lib/:/lib/x86_64-redhat-linux6E/:/usr/lib/x86_64-redhat-linux6E <span class=se>\ </span>
</span></span><span class=line><span class=cl>         /usr/local/node-18.19/bin/node
</span></span></code></pre></div><h3 id=5-替换到vscode><strong>5. 替换到VSCode</strong></h3><p>在<code>~/.vscode-server/bin/{id}</code>中存储了VSCode自带的node实例，这里简单替换下，可以将下面的内容保存到<code>.sh</code>脚本运行（记得替换成自己的路径）。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># 记得替换成自己的路径</span>
</span></span><span class=line><span class=cl><span class=nv>binary_base</span><span class=o>=</span><span class=s2>&#34;/root/.vscode-server/bin/903b1e9d8990623e3d7da1df3d33db3e42d80eda&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>replace_base</span><span class=o>=</span><span class=s2>&#34;/usr/local/node-18.19&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mv <span class=s2>&#34;</span><span class=nv>$binary_base</span><span class=s2>/node&#34;</span> <span class=s2>&#34;</span><span class=nv>$binary_base</span><span class=s2>/node.bak&#34;</span>
</span></span><span class=line><span class=cl>ln -sf <span class=s2>&#34;</span><span class=nv>$replace_base</span><span class=s2>/bin/node&#34;</span> <span class=s2>&#34;</span><span class=nv>$binary_base</span><span class=s2>/node&#34;</span>
</span></span></code></pre></div><p>接着，kill掉VSCode所在的进程，或直接重启机器，再重新连接就完成了。</p><p>或者使用下面这个脚本，一键替换机器上所有VSCode实例:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># upgrade vscode&#39;s node binary to v18</span>
</span></span><span class=line><span class=cl><span class=k>function</span> _internal_replace_binary<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>binary_base</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>replace_base</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$2</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    mv <span class=s2>&#34;</span><span class=nv>$binary_base</span><span class=s2>/node&#34;</span> <span class=s2>&#34;</span><span class=nv>$binary_base</span><span class=s2>/node.bak&#34;</span>
</span></span><span class=line><span class=cl>    ln -sf <span class=s2>&#34;</span><span class=nv>$replace_base</span><span class=s2>/bin/node&#34;</span> <span class=s2>&#34;</span><span class=nv>$binary_base</span><span class=s2>/node&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;✅ 升级成功: </span><span class=nv>$binary_base</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> _internal_replace_all_vscode_server<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>replace_base</span><span class=o>=</span><span class=s2>&#34;/usr/local/node-18.19&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[</span> ! -f <span class=s2>&#34;</span><span class=nv>$replace_base</span><span class=s2>/bin/node&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;❎: 镜像文件缺失 (</span><span class=nv>$replace_base</span><span class=s2>/bin/node)&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> dir in <span class=k>$(</span>find ~/.vscode-server/bin -maxdepth <span class=m>1</span> -mindepth <span class=m>1</span> -type d<span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=k>do</span>
</span></span><span class=line><span class=cl>        _internal_replace_binary <span class=nv>$dir</span> <span class=nv>$replace_base</span>
</span></span><span class=line><span class=cl>    <span class=k>done</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;✅ 全部完成: 请重连 VSCode 或重启设备&#34;</span>
</span></span><span class=line><span class=cl>    ps -ef <span class=p>|</span> grep <span class=s2>&#34;\.vscode-server/bin&#34;</span> <span class=p>|</span> grep node <span class=p>|</span> awk <span class=s1>&#39;{print($2)}&#39;</span> <span class=p>|</span> xargs -i <span class=nb>kill</span> <span class=o>{}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>_internal_replace_all_vscode_server
</span></span></code></pre></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()></a></span>&nbsp;|&nbsp;<span><a href=/></a></span></section></div><div class=post-nav><a href=/posts/%E7%BA%A2%E9%BB%91%E6%A0%91%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/ class=prev rel=prev title=红黑树基础操作><i class="fas fa-angle-left fa-fw"></i>红黑树基础操作</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"",maxShownLines:10},comment:{},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>